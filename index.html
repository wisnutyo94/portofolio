<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Booking De'Barba Barber</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  font-family: 'Merriweather', serif;
}

body {
  background: #000;
  color: #fff;
  padding: 20px;
}

.container {
  max-width: 640px;
  margin: auto;
  background: #111;
  padding: 30px;
  border-radius: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 25px;
}

.form-group {
  margin-bottom: 15px;
}

label {
  font-size: 14px;
  margin-bottom: 6px;
  display: block;
}

input, select {
  width: 100%;
  height: 48px;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid #333;
  background: #222;
  color: #fff;
  font-size: 14px;
}

input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(1);
}

select option:disabled {
  color: #999;
}

button {
  width: 100%;
  padding: 14px;
  background: #fff;
  color: #000;
  border: none;
  border-radius: 14px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
}

.powered {
  text-align: center;
  font-size: 12px;
  color: #777;
  margin-top: 20px;
}
</style>
</head>

<body>

<div class="container">
  <h1>Booking De'Barba Barber</h1>

  <form id="bookingForm">

    <div class="form-group">
      <label>Nama Lengkap</label>
      <input type="text" name="nama_lengkap" required>
    </div>

    <div class="form-group">
      <label>Nomor Whatsapp</label>
      <input type="text" name="nomor_whatsapp" required>
    </div>

    <div class="form-group">
      <label>Email</label>
      <input type="email" name="email" required>
    </div>

    <div class="form-group">
      <label>Pilih Kapster</label>
      <select name="pilih_kapster" required>
        <option value="">-- Pilih Kapster --</option>
        <option>Bayu</option>
        <option>Joel</option>
      </select>
    </div>

    <div class="form-group">
      <label>Pilih Layanan</label>
      <select name="pilih_layanan" required>
        <option value="">-- Pilih Layanan --</option>
        <option>Regular Haircut - 50k</option>
        <option>Coloring - 200k</option>
        <option>Coloring - 300k</option>
        <option>Coloring - 400k</option>
      </select>
    </div>

    <div class="form-group">
      <label>Pilih Tanggal</label>
      <input type="date" name="pilih_tanggal" id="tanggal" required>
    </div>

    <div class="form-group">
      <label>Pilih Jam</label>
      <select name="pilih_jam" id="jam" required>
        <option value="">-- Pilih Jam --</option>
      </select>
    </div>

    <button type="submit">Booking Sekarang</button>
  </form>

  <div class="powered">Powered by De'Barba Barber Â© 2026</div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyE_COU2g1rgzF5Ggn4tXzrpf6r4l7rFSdYH-eftvXYjgkzZL9sMrqR3WKMV3Ven9C2/exec"; // GANTI

const form = document.getElementById("bookingForm");
const tanggalInput = document.getElementById("tanggal");
const jamSelect = document.getElementById("jam");

// Generate jam 11.00 - 23.00
const jamList = [];
for (let i = 11; i <= 23; i++) {
  jamList.push(i.toString().padStart(2, "0") + ".00");
}

// Disable tanggal sebelum hari ini
const today = new Date().toISOString().split("T")[0];
tanggalInput.min = today;

// Ambil booking dari Sheet
async function loadBooked() {
  try {
    const res = await fetch(WEB_APP_URL);
    return await res.json();
  } catch (e) {
    console.error("Gagal load booked:", e);
    return {};
  }
}

// Update jam
async function updateJam() {
  const tanggal = tanggalInput.value;
  if (!tanggal) return;

  jamSelect.innerHTML = `<option value="">Loading...</option>`;

  const bookedData = await loadBooked();
  const bookedJam = bookedData[tanggal] || [];

  jamSelect.innerHTML = `<option value="">-- Pilih Jam --</option>`;

  jamList.forEach(jam => {
    const opt = document.createElement("option");
    opt.value = jam;

    if (bookedJam.includes(jam)) {
      opt.textContent = jam + " (Booked)";
      opt.disabled = true;
    } else {
      opt.textContent = jam;
    }

    jamSelect.appendChild(opt);
  });
}

tanggalInput.addEventListener("change", updateJam);

// Submit
form.addEventListener("submit", e => {
  e.preventDefault();
  const formData = new FormData(form);

  fetch(WEB_APP_URL, {
    method: "POST",
    body: formData
  })
  .then(() => {
    alert("Booking berhasil!");
    form.reset();
    jamSelect.innerHTML = `<option value="">-- Pilih Jam --</option>`;
  })
  .catch(() => alert("Gagal booking!"));
});
</script>

</body>
</html>
